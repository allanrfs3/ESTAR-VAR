{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">Estimasi Model ESTAR</h2>

    <!-- Form Input p dan d -->
    <form method="POST" class="mb-4">
        <div class="mb-3">
            <label for="p" class="form-label">Masukkan nilai p:</label>
            <input type="number" id="p" name="p" class="form-control" required value="{{ session.get('p', '') }}">
            <small class="form-text text-muted">
                Nilai p menunjukkan jumlah lag yang digunakan dalam model AR.
            </small>
        </div>

        <div class="mb-3">
            <label for="d" class="form-label">Masukkan nilai d:</label>
            <input type="number" id="d" name="d" class="form-control" required value="{{ session.get('d', '') }}">
            <small class="form-text text-muted">
                Nilai d menunjukkan jumlah delay yang digunakan untuk variabel transisi model STAR dengan 1 ≤ d ≤ p.
            </small>
        </div>

        <button type="submit" class="btn btn-primary">Hitung ESTAR</button>
    </form>

    <!-- Tampilkan Hasil Estimasi -->
    {% if results %}
        <h3 class="mt-4">Hasil Estimasi Parameter:</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Estimate</th>
                    <th>Standard Error</th>
                    <th>t-value</th>
                    <th>p-value</th>
                </tr>
            </thead>
            <tbody>
                {% for row in results %}
                <tr>
                    <td>{{ row.Parameter }}</td>
                    <td>{{ row.Estimate }}</td>
                    <td>{{ row['Standard Error'] }}</td>
                    <td>{{ row['t-value'] }}</td>
                    <td>{{ row['p-value'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <hr class="my-4"> <!-- Sekatan antara hasil estimasi dan hasil uji -->

    {% endif %}

    <!-- Tampilkan Hasil Uji Asumsi -->
    {% if dw_stat %}
        <h3 class="mt-4">Hasil Uji Asumsi Residual ESTAR:</h3>

        <!-- Tabel Uji Durbin-Watson -->
        <h4>Uji Durbin-Watson</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Statistik DW</th>
                    <th>Kritikal Bawah</th>
                    <th>Kritikal Atas</th>
                    <th>Hasil</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ dw_stat }}</td>
                    <td>1.5</td>
                    <td>2.5</td>
                    <td>{% if dw_result %}✅ Tidak ada autokorelasi yang signifikan. {% else %}❌ Terjadi autokorelasi dalam residual. {% endif %}</td>
                </tr>
            </tbody>
        </table>

        <!-- Tabel Uji ARCH-LM -->
        <h4>Uji Homoskedastisitas (ARCH-LM)</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Statistik LM</th>
                    <th>Nilai Kritis χ²</th>
                    <th>p-value</th>
                    <th>Hasil</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ lm_stat }}</td>
                    <td>{{ t_critical_arch }}</td>
                    <td>{{ lm_pval }}</td>
                    <td>{% if arch_result %}✅ Residual memiliki varians yang homogen. {% else %}❌ Residual memiliki varians yang tidak homogen. {% endif %}</td>
                </tr>
            </tbody>
        </table>

        <!-- Tabel Uji Kolmogorov-Smirnov -->
        <h4>Uji Normalitas (Kolmogorov-Smirnov)</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Nilai Statistik KS</th>
                    <th>p-value K-S</th>
                    <th>Nilai Kritis D</th>
                    <th>Hasil</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ ks_statistic }}</td>
                    <td>{{ ks_pvalue }}</td>
                    <td>{{ ks_critical }}</td>
                    <td>{% if ks_result %}✅ Residual berdistribusi normal. {% else %}❌ Residual tidak berdistribusi normal. {% endif %}</td>
                </tr>
            </tbody>
        </table>

        <!-- Tombol Next -->
    <div class="mt-4">
        <a href="{{ url_for('prediksi_estar') }}" class="btn btn-primary">Lanjut prediksi dengan model ESTAR</a>
    </div>
    
    {% endif %}
    
</div>
{% endblock %}